# Milestone v1.1: Distribution & Compatibility

**Status:** SHIPPED 2026-02-03
**Phases:** 8-13 (+ 11.1 inserted)
**Total Plans:** 13

## Overview

Anyone can install QtMCP from their preferred package manager and CI produces tested binaries for every supported Qt version.

## Phases

### Phase 8: CMake Multi-Qt Foundation
**Goal**: Build system correctly produces versioned, Qt-aware, relocatable artifacts for both Qt5 and Qt6
**Depends on**: Phase 7 (v1.0 complete)
**Requirements**: BUILD-01, BUILD-02, BUILD-03
**Plans**: 2 plans

Plans:
- [x] 08-01-PLAN.md — Versioned artifact naming and install layout
- [x] 08-02-PLAN.md — find_package config and qtmcp_inject_probe helper

**Details:**
- Probe output encodes Qt version: `qtmcp-probe-qt6.8.dll`
- Install layout: `lib/qtmcp/qt{M}.{m}/` for side-by-side versions
- QtMCPConfig.cmake auto-detects consumer Qt version
- Manual IMPORTED target for versioned path support

### Phase 9: CI Matrix Build
**Goal**: Every push validates the probe builds cleanly on 4 Qt versions across Windows and Linux
**Depends on**: Phase 8
**Requirements**: CICD-01, CICD-02, CICD-03, CICD-04
**Plans**: 1 plan

Plans:
- [x] 09-01-PLAN.md — Matrix CI workflow with 8 cells (4 Qt versions x 2 platforms)

**Details:**
- Matrix: Qt 5.15, 6.5, 6.8, 6.9 × Windows (MSVC) / Linux (GCC)
- Uses `jurplel/install-qt-action@v4` for Qt installation
- Runner OS varies per Qt version (Ubuntu 22.04 for 5.15, 24.04 for 6.x)

### Phase 10: Patched Qt 5.15.1 CI
**Goal**: CI can build and cache a custom-patched Qt 5.15.1 and produce probe binaries against it
**Depends on**: Phase 9
**Requirements**: CICD-05, CICD-06
**Plans**: 2 plans

Plans:
- [x] 10-01-PLAN.md — Build-Qt composite action and patch directory scaffold
- [x] 10-02-PLAN.md — Patched Qt CI workflow with 2 matrix cells

**Details:**
- Builds Qt 5.15.1 from source with GCC 11+ compatibility patches
- Aggressive caching (cache hit skips 30-60 min build)
- Push-only trigger (no PR builds) to save CI minutes
- Windows pinned to windows-2022 for MSVC v142 toolset

### Phase 11: Release Automation
**Goal**: Pushing a version tag automatically produces a complete GitHub Release with all binaries
**Depends on**: Phase 9, Phase 10
**Requirements**: CICD-07, CICD-08
**Plans**: 2 plans

Plans:
- [x] 11-01-PLAN.md — Add workflow_call triggers to both CI workflows
- [x] 11-02-PLAN.md — Release workflow with artifact collection and GitHub Release

**Details:**
- Tag push triggers release workflow
- Calls both CI workflows as reusable workflows
- Collects all 10 probe binaries (8 standard + 2 patched)
- Generates SHA256SUMS file
- Creates GitHub Release via `softprops/action-gh-release@v2`

### Phase 11.1: Qt 5.15 / Qt 6 Source Compatibility (INSERTED)
**Goal**: Source code compiles cleanly against both Qt 5.15 and Qt 6 without conditional compilation hacks
**Depends on**: Phase 11
**Requirements**: COMPAT-01
**Plans**: 2 plans

Plans:
- [x] 11.1-01-PLAN.md — Compat headers and source file fixes for Qt5/Qt6 API divergence
- [x] 11.1-02-PLAN.md — CMake minimum version enforcement and CI matrix update (6.2 → 6.5)

**Details:**
- Created `include/qtmcp/compat/` headers for API divergence
- QT_DISABLE_DEPRECATED_BEFORE=0x050F00 rejects pre-5.15 APIs
- CMake enforces Qt 5.15.1+ / 6.5+ minimums
- CI matrix updated: Qt 6.2 → 6.5.3 LTS

### Phase 12: vcpkg Port
**Goal**: Users can install QtMCP via vcpkg overlay port using either their own Qt5 or Qt6
**Depends on**: Phase 11
**Requirements**: VCPKG-01, VCPKG-02, VCPKG-03
**Plans**: 2 plans

Plans:
- [x] 12-01-PLAN.md — Source overlay port (builds probe from source against user's Qt)
- [x] 12-02-PLAN.md — Binary overlay port (downloads prebuilt probe from GitHub Releases)

**Details:**
- `ports/qtmcp/` — Source port, no Qt dependency declared (uses user's Qt)
- `ports/qtmcp-bin/` — Binary port with per-Qt-version SHA512 validation
- Both ports create QtMCP::Probe IMPORTED target
- SHA512 placeholders must be updated after first release

### Phase 13: PyPI Publication
**Goal**: `pip install qtmcp` gives users a working MCP server with a CLI to fetch the correct probe
**Depends on**: Phase 11
**Requirements**: PYPI-01, PYPI-02, PYPI-03, PYPI-04
**Plans**: 2 plans

Plans:
- [x] 13-01-PLAN.md — download-probe CLI subcommand with platform detection
- [x] 13-02-PLAN.md — PyPI metadata and OIDC publishing workflow

**Details:**
- `qtmcp download-probe --qt-version 6.8` fetches correct probe
- Hatchling build backend for pure-Python wheel
- OIDC Trusted Publishers (no API tokens)
- Publishing triggers on GitHub Release publication

---

## Milestone Summary

**Decimal Phases:**
- Phase 11.1: Qt5/Qt6 Source Compatibility (inserted after Phase 11 for urgent compatibility fix)

**Key Decisions:**

| Decision | Rationale |
|----------|-----------|
| Versioned artifact naming | `qtmcp-probe-qt{M}.{m}` encodes Qt version for side-by-side installs |
| Manual IMPORTED target | Supports versioned lib paths; CMake EXPORT doesn't |
| Qt 6.2 dropped for 6.5 | 6.2 below new minimum; replaced with 6.5.3 LTS |
| No Qt deps in vcpkg port | User provides Qt; port just builds against it |
| OIDC Trusted Publishers | Secure keyless PyPI publishing |
| Per-artifact SHA512 | Binary port validates individual downloads |

**Issues Resolved:**
- Qt5/Qt6 API divergence (QVariant::Type, QByteArray::toStdString, etc.)
- GCC 11+ compatibility with Qt 5.15.1 source build
- CI matrix OS version requirements per Qt version

**Issues Deferred:**
- macOS support (v1.2 milestone)
- Code signing for Windows DLLs
- vcpkg curated registry submission

**Technical Debt Incurred:**
- SHA512 placeholders in vcpkg ports (update after first release tag)
- Hardcoded v1.0.0 in download.py for release_tag="latest"

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-02-03 as part of v1.1 milestone completion*
