---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - CMakeLists.txt
  - CMakePresets.json
  - vcpkg.json
  - src/probe/CMakeLists.txt
  - src/launcher/CMakeLists.txt
autonomous: true

must_haves:
  truths:
    - "CMake configure succeeds on Windows and Linux"
    - "vcpkg can resolve Qt dependencies"
    - "Build system produces probe shared library and launcher executable targets"
  artifacts:
    - path: "CMakeLists.txt"
      provides: "Root build configuration"
      contains: "project(QtMCP"
    - path: "vcpkg.json"
      provides: "Package manifest"
      contains: "qtbase"
    - path: "src/probe/CMakeLists.txt"
      provides: "Probe library build"
      contains: "add_library"
    - path: "src/launcher/CMakeLists.txt"
      provides: "Launcher executable build"
      contains: "add_executable"
  key_links:
    - from: "CMakeLists.txt"
      to: "src/probe/CMakeLists.txt"
      via: "add_subdirectory"
      pattern: "add_subdirectory.*probe"
---

<objective>
Set up the CMake build system and project structure for QtMCP.

Purpose: Establish the foundation that all subsequent plans build upon. Without a working build system, no code can be compiled or tested.

Output:
- Root CMakeLists.txt with Qt 5.15/6.x detection
- vcpkg.json manifest for dependency management
- Subdirectory CMakeLists for probe (shared library) and launcher (executable)
- CMakePresets.json for consistent build configuration
</objective>

<execution_context>
@C:\Users\stjohnson\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\stjohnson\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create root CMakeLists.txt and CMakePresets.json</name>
  <files>CMakeLists.txt, CMakePresets.json</files>
  <action>
Create the root CMakeLists.txt:
- Project name: QtMCP
- Minimum CMake version: 3.16
- C++ standard: C++17
- Find Qt: Support both Qt5 (5.15+) and Qt6 with preference for Qt6
- Required Qt components: Core, Network, WebSockets
- Define two targets via add_subdirectory: probe and launcher
- Set output directories: bin/ for executables, lib/ for libraries
- Use BUILD_SHARED_LIBS option (default ON for probe)

Create CMakePresets.json:
- Configure presets for Debug and Release
- Use vcpkg toolchain file if VCPKG_ROOT is set
- Windows preset with MSVC, /MD runtime
- Linux preset with GCC
- Include common settings (CMAKE_EXPORT_COMPILE_COMMANDS ON)

Follow Qt CMake best practices from Qt documentation. Do NOT use deprecated qt5_* commands.
  </action>
  <verify>
Run: cmake --preset debug (or cmake -B build -DCMAKE_BUILD_TYPE=Debug)
Expected: Configure completes without errors, finds Qt WebSockets
  </verify>
  <done>CMake configure succeeds and detects Qt with WebSockets module</done>
</task>

<task type="auto">
  <name>Task 2: Create vcpkg.json manifest and probe/launcher CMakeLists</name>
  <files>vcpkg.json, src/probe/CMakeLists.txt, src/launcher/CMakeLists.txt</files>
  <action>
Create vcpkg.json manifest:
- Name: qtmcp
- Version: 0.1.0
- Dependencies: qtbase, qtwebsockets
- Use features for optional components if needed

Create src/probe/CMakeLists.txt:
- Define qtmcp-probe as SHARED library
- Link Qt::Core, Qt::Network, Qt::WebSockets
- Set VERSION property
- Windows-specific: Export symbols with WINDOWS_EXPORT_ALL_SYMBOLS or explicit dllexport
- Set output name to "qtmcp-probe" (or "qtmcp-probe.dll" / "libqtmcp-probe.so")
- Add placeholder source file (probe_stub.cpp with empty implementation) so CMake can configure

Create src/launcher/CMakeLists.txt:
- Define qtmcp-launch as executable
- Link Qt::Core (for QCoreApplication, QCommandLineParser)
- Set output name to "qtmcp-launch"
- Add placeholder source file (main_stub.cpp with minimal main())

Create the directory structure: src/probe/, src/launcher/
Create stub files so CMake can configure without real implementation.
  </action>
  <verify>
Run: cmake -B build && cmake --build build
Expected: Builds successfully, produces qtmcp-probe.dll/so and qtmcp-launch executable (stubs)
  </verify>
  <done>Build system produces placeholder probe library and launcher executable</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `cmake -B build` succeeds with Qt detection message
2. `cmake --build build` produces executables in expected locations
3. On Windows: build/bin/qtmcp-launch.exe and build/lib/qtmcp-probe.dll exist
4. On Linux: build/bin/qtmcp-launch and build/lib/libqtmcp-probe.so exist
</verification>

<success_criteria>
- CMake configures without errors on the development machine
- Both targets (probe library, launcher executable) build successfully
- vcpkg manifest is valid JSON
- Build artifacts appear in expected output directories
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
