---
phase: 01-foundation
plan: 06
type: execute
wave: 5
depends_on: ["01-05"]
files_modified:
  - test_app/CMakeLists.txt
  - test_app/main.cpp
  - test_app/mainwindow.h
  - test_app/mainwindow.cpp
  - test_app/mainwindow.ui
  - CMakeLists.txt
autonomous: false

must_haves:
  truths:
    - "Test app launches and shows a Qt window"
    - "qtmcp-launch test_app injects probe successfully"
    - "WebSocket client can connect and execute qtmcp.echo"
    - "User can verify probe is working with visual feedback"
  artifacts:
    - path: "test_app/main.cpp"
      provides: "Test application entry point"
      contains: "QApplication"
    - path: "test_app/mainwindow.cpp"
      provides: "Main window with named widgets"
      contains: "QMainWindow"
  key_links:
    - from: "test_app"
      to: "qtmcp-launch"
      via: "launched by"
      pattern: "injected"
---

<objective>
Create a test Qt application and verify end-to-end injection and communication.

Purpose: Prove that the entire Phase 1 foundation works: launcher starts app, probe injects, WebSocket accepts connections, JSON-RPC works. This is the validation that all requirements (INJ-01 through INJ-05) are met.

Output:
- Simple Qt Widgets application with named widgets
- End-to-end test workflow documentation
- Human verification that probe works
</objective>

<execution_context>
@C:\Users\stjohnson\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\stjohnson\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test Qt application</name>
  <files>test_app/CMakeLists.txt, test_app/main.cpp, test_app/mainwindow.h, test_app/mainwindow.cpp, test_app/mainwindow.ui, CMakeLists.txt</files>
  <action>
Create test_app/CMakeLists.txt:
- Add Qt Widgets dependency: find_package(Qt6 REQUIRED COMPONENTS Widgets)
- Define test-app executable
- Link Qt::Core, Qt::Widgets
- Enable AUTOMOC, AUTOUIC

Create test_app/main.cpp:
- Create QApplication
- Create MainWindow
- Show window
- Return app.exec()

Create test_app/mainwindow.h:
- Class MainWindow : public QMainWindow
- Ui::MainWindow* ui
- Constructor, destructor

Create test_app/mainwindow.cpp:
- Set up UI from .ui file
- Set objectName on main window: "mainWindow"
- Connect button click to slot that updates label

Create test_app/mainwindow.ui (or create programmatically):
- QMainWindow with centralWidget
- QVBoxLayout containing:
  - QLabel with objectName "statusLabel", text "Ready"
  - QPushButton with objectName "testButton", text "Click Me"
  - QLineEdit with objectName "inputField"
- Window title: "QtMCP Test App"

Update root CMakeLists.txt:
- Add option(BUILD_TEST_APP "Build test application" ON)
- If BUILD_TEST_APP: add_subdirectory(test_app)

The test app should be simple but have enough widgets to demonstrate future object introspection.
  </action>
  <verify>
Run: cmake --build build && ./build/bin/test-app
Expected: Window appears with button, label, and text input
  </verify>
  <done>Test Qt application builds and runs with visible widgets</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 1 foundation: launcher, probe, WebSocket server, JSON-RPC handler, test app</what-built>
  <how-to-verify>
1. Build everything: `cmake -B build && cmake --build build`

2. Start the test app with probe:
   - Windows: `build\bin\qtmcp-launch.exe build\bin\test-app.exe`
   - Linux: `build/bin/qtmcp-launch build/bin/test-app`

3. Verify startup message appears:
   - Should see: "QtMCP listening on ws://0.0.0.0:9222"

4. Open a WebSocket client (install websocat: `cargo install websocat`):
   - `websocat ws://localhost:9222`

5. Send a JSON-RPC request:
   ```json
   {"jsonrpc":"2.0","method":"qtmcp.echo","params":{"test":"hello"},"id":1}
   ```

6. Verify response:
   ```json
   {"jsonrpc":"2.0","result":{"test":"hello"},"id":1}
   ```

7. Try connecting a second WebSocket client:
   - Should be rejected immediately

8. Close first client, reconnect:
   - Should succeed

9. Test --port flag:
   - `qtmcp-launch --port 9333 test-app`
   - Connect to ws://localhost:9333

10. Test --quiet flag:
    - No startup message should appear
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any failures</resume-signal>
</task>

</tasks>

<verification>
Phase 1 is complete when user confirms:
1. Test app runs normally when launched directly
2. Test app runs with probe when launched via qtmcp-launch
3. WebSocket connection to probe succeeds
4. JSON-RPC echo works correctly
5. Single-client enforcement works
6. All CLI flags (--port, --quiet, --detach) work
</verification>

<success_criteria>
- INJ-01: Linux LD_PRELOAD injection works
- INJ-02: Windows DLL injection works
- INJ-03: WebSocket server on configurable port (default 9222)
- INJ-04: JSON-RPC 2.0 message handling works
- INJ-05: Configuration via CLI flags (port, etc.)
- All Phase 1 success criteria from ROADMAP.md are met
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-06-SUMMARY.md`
</output>
