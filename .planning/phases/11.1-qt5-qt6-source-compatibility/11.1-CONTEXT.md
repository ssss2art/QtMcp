# Phase 11.1: Qt 5.15 / Qt 6 Source Compatibility - Context

**Gathered:** 2026-02-02
**Status:** Ready for planning

<domain>
## Phase Boundary

Make the QtMCP source code compile and run correctly against both Qt 5.15 and Qt 6 without runtime behavioral differences. This phase fixes existing source incompatibilities — it does not add new features or change functionality.

</domain>

<decisions>
## Implementation Decisions

### Compatibility approach
- Use per-module compat headers (e.g., compat_core.h, compat_network.h) with macros/typedefs to abstract Qt5/Qt6 API differences
- Compat headers live in `src/compat/` (internal, not public)
- When a Qt6 API has no Qt5 equivalent, provide a polyfill in the compat header so both versions use the same call site
- No inline `#if QT_VERSION` blocks at call sites — all divergence handled through compat headers

### Deprecation handling
- Fix all deprecation warnings — replace every deprecated API call with the recommended alternative (via compat macros where needed)
- Build with warnings as errors (-Werror / /WX) on all platforms, both locally and in CI
- Set QT_DISABLE_DEPRECATED_BEFORE to Qt 5.15.0 — anything deprecated before 5.15.0 triggers a build error
- Use Qt5 API names as the canonical names in source; compat headers map Qt5 names to Qt6 equivalents where they diverged

### Feature parity
- Qt5 and Qt6 builds must have identical runtime behavior — no Qt6-only code paths
- Minimum supported versions: Qt 5.15.1 and Qt 6.5
- CMake configuration must fail with a hard error if Qt version is below minimum, with a clear message

### Testing strategy
- CI matrix is the primary build verification — no new compat-specific unit tests needed
- Update CI matrix to drop Qt 6.2 (below new minimum) and ensure 6.5+ coverage
- Phase is complete when: CI green with zero warnings on all matrix cells AND manual smoke test of probe injection on both a Qt5 and Qt6 application

### Claude's Discretion
- Exact compat macro naming conventions
- Which APIs need polyfills vs simple typedefs
- Order of source file changes
- How to structure the manual smoke test

</decisions>

<specifics>
## Specific Ideas

- Qt 5.15.1 minimum aligns with the patched Qt CI target from Phase 10
- Per-module compat headers keep includes focused — each source file only pulls in what it needs
- Polyfill approach preferred over conditional compilation to keep call sites clean

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 11.1-qt5-qt6-source-compatibility*
*Context gathered: 2026-02-02*
